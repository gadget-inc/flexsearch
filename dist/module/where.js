import FlexSearch from"./flexsearch.js";import{get_keys,is_function,is_object,is_undefined}from"./common.js";FlexSearch.prototype.find=function(a,b){return this.where(a,b,1)[0]||null},FlexSearch.prototype.where=function(a,b,c,d){const e=this._doc,f=[];let g,h,j,k,l,m=0;if(is_object(a)){if(c||(c=b),g=get_keys(a),h=g.length,j=!1,1===h&&"id"===g[0])return[e[a.id]];const f=this._tags;if(f&&!d)for(let b=0;b<f.length;b++){const c=f[b],d=a[c];if(!is_undefined(d)){if(l=this._tag[c]["@"+d],0==--h)return l;g.splice(g.indexOf(c),1),delete a[c];break}}k=Array(h);for(let a=0;a<h;a++)k[a]=g[a].split(":")}else{if(is_function(a)){const b=d||get_keys(e),c=b.length;for(let d=0;d<c;d++){const c=e[b[d]];a(c)&&(f[m++]=c)}return f}if(is_undefined(b))return[e[a]];if("id"===a)return[e[b]];g=[a],h=1,k=[a.split(":")],j=!0}const n=l||d||get_keys(e),o=n.length;for(let i=0;i<o;i++){const d=l?n[i]:e[n[i]];let o=!0;for(let c=0;c<h;c++){j||(b=a[g[c]]);const e=k[c],f=e.length;let h=d;if(1<f)for(let a=0;a<f;a++)h=h[e[a]];else h=h[e[0]];if(h!==b){o=!1;break}}if(o&&(f[m++]=d,c&&m===c))break}return f};